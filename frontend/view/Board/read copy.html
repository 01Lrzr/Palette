<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script defer src = "/public/js/read.js"></script>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- favicon -->
<link rel="icon" href="/favicon.png" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
    
<!-- font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

<link rel = "stylesheet" href="/public/css/read.css">

<title>Post</title>

   <!-- header jquery -->
   <script type="text/javascript">   
    $(document).ready( function() {
    $("#headers").load("/public/static/header.html");  
    });
  </script>
  <!-- footer jquery -->
  <script type="text/javascript">   
    $(document).ready( function() {
    $("#footers").load("/public/static/footer.html");  
    });
  </script>

<!-- 출력  -->
<script type="text/javascript">   
  $(document).ready( function() {
    view();
  });
</script>

<!-- 수정페이지 -->
<script type="text/javascript">
  function modifyPost(postId){
        //sessionStorage.setItem("postId", postId);
        window.location.href = "./update.html";
      }  
</script>

<!-- ajax 요청 -->
<script type="text/javascript">   
    
  function view() {
    var frm = $('#frmpost');
    let postId = sessionStorage.getItem("postId");

    var params = '';  // 개발시 변경 부분
    var msg = '';

    $.ajax({
      //url: 'http://ec2-3-35-87-7.ap-northeast-2.compute.amazonaws.com:8080/api/post/{id}', // 개발시 변경 부분
      url: 'http://ec2-3-35-87-7.ap-northeast-2.compute.amazonaws.com:8080/api/post/'+postId, // 개발시 변경 부분
      contentType: 'application/json; charset=UTF-8',
      type: 'get',  // get, post
      cache: false, // 응답 결과 임시 저장 취소
      async: true,  // true: 비동기 통신
      dataType: 'json', // 응답 형식: json, html, xml...
      data: params,      // 데이터

      success: function(testData) { // 서버로부터 성공적으로 응답이 온경우
          
        if (testData.postId > 0) { 

          console.log(testData)
          //alert('내용  ㅇㅇ' +  testData.postGroupResponses[0].memberName);

          $('#day').empty();
          $('#title').empty();       
          $('#author').empty();
          $('#photo').empty();       
          $('#content').empty();
          $('#result').empty();
          $('.comment-date').empty();
          $('.comment-content').empty();


          $("#title").append("<div>"+testData.postTitle+"</div>");
          $("#author").append("<div>"+testData.memberName+"</div>");
          $("#photo").append("<div><figure class='image'><img src=' " + testData.images[0] + " '/></figure></div>");
          $("#content").append("<div>"+testData.postContent+"</div>");
          $("#result").append("<div>"+testData.likes+"</div>");

          for(i=0; i<testData.comments.length; i++){
           $('.comment-row0').append("<div class = 'comment-row'><div class = 'comment-date'>"+testData.comments[i].createDate+"\
                                      </div><div class = 'comment-memberName'>"+testData.comments[i].memberName+"</div><div class = 'comment-content'>\
                                      "+testData.comments[i].commentContent+"\
                                       <input type = 'button' class='modifycomment'  value='수정' onclick='modifyComment(this.id)' id="+testData.comments[i].commentId +">\
                                       <input type = 'button' class='deletecomment'  value='삭제' onclick='deleteComment(this.id)' id="+testData.comments[i].commentId +"></div>"); 
          }
        } else {  
          testData.postGroupResponses[0].postGroupId.value();

          alert('내용 xx' + testData.postGroupResponses[0].postGroupId.val());
        }
      },

      // Ajax 통신 에러, 응답 코드가 200이 아닌경우, dataType이 다른경우 
      error: function(request, status, error) { // callback 함수
        alert('ajax야 힘내자'+ request +status + error);
      }
    });
  }

</script>

<!-- ajax 요청 (글삭제) -->
<script type="text/javascript">   
  
  
  //debugger;     
  function deletePost() {
    let token = sessionStorage.getItem("token"); 
    let postGroupId = sessionStorage.getItem("postGroupId");
    let postId = sessionStorage.getItem("postId");

    $.ajax({
      url: 'http://ec2-3-35-87-7.ap-northeast-2.compute.amazonaws.com:8080/api/postgroup/'+ postGroupId+'/post/'+postId, // 개발시 변경 부분  
      type: 'DELETE',  // get, post
  
      success: function(testData) { // 서버로부터 성공적으로 응답이 온경우
          
        
      },

      // Ajax 통신 에러, 응답 코드가 200이 아닌경우, dataType이 다른경우 
      error: function(request, status, error) { // callback 함수
        //alert('ajax야 힘내자'+ request +status + error);
        console.log('ajax야 힘내자'+ request +status + error);
        alert("삭제 권한이 없습니다");
      },

beforeSend: function (xhr) {
  xhr.setRequestHeader("Authorization","Bearer " + token);
}
    });
  }

</script>

</head>

<body>
  <!-- header 연결 -->
  <div id="headers"></div>

    <div class="container">
      <div class="inner">

        <form id = "frmpost" name = "frmpost">

          <input type="hidden" id="memberId" name="memberId" value=""/>
          <input type="hidden" id="memberName" name="memberName" value=""/>
          <input type="hidden" id="postId" name="postId" value=""/>
          <input type="hidden" id="postTitle" name="postTitle" value=""/>
          <input type="hidden" id="postContent" name="postContent" value=""/>
          <input type="hidden" id="likes" name="likes" value=""/>
          <input type="hidden" id="images" name="images" value=""/>
          <input type="hidden" id="comments_memberId" name="comments_memberId" value=""/>
          <input type="hidden" id="comments_memberName" name="comments_memberName" value=""/>
          <input type="hidden" id="comments_commentId" name="comments_commentId" value=""/>
          <input type="hidden" id="comments_commentContent" name="comments_commentContent" value=""/>
          <input type="hidden" id="comments_createDate" name="comments_createDate" value=""/>

        <div class="day" id = "day" name = "day">
          DAY
        </div>
 
        <div class="title" id = "title" name = "title">
          title  
        </div>

        <div class="author" id = "author" name = "author">
          author
        </div>

        <div class="photo" id = "photo" name = "photo">
          <figure class="image"><img src="https://w.namu.la/s/f4eeb4d000580ed54510801ede6bf71d9726acbca886db89a0c6bb43bab73391af5ff23873c660752e3604c47f5eac3f0593f2d3e5e263cc3e005ce2ee398fb7fe7214c9151bd30ce40f385fbe671b4ac2ee2be5c41c675d6b1621eac84ca63c" alt=""></figure>
        </div>
<!-- 
          <div class="swiper-container mySwiper" id = "photo" name="photo">

          <div class="swiper-wrapper" >
            <div class="swiper-slide">
              <img src="https://w.namu.la/s/f4eeb4d000580ed54510801ede6bf71d9726acbca886db89a0c6bb43bab73391af5ff23873c660752e3604c47f5eac3f0593f2d3e5e263cc3e005ce2ee398fb7fe7214c9151bd30ce40f385fbe671b4ac2ee2be5c41c675d6b1621eac84ca63c" />
            </div>
            <div class="swiper-slide">
              <img src="https://www.visitbusan.net/uploadImgs/files/cntnts/20191229153530528_ttiel" />
            </div>
            <div class="swiper-slide">
              <img src="https://post-phinf.pstatic.net/MjAyMDA5MTFfMjM3/MDAxNTk5ODEyNDE1NjAy.p-GWwJKctfgX7d4Mz9eMTtCjt9lsqnO6NWG31y1UEL4g.igYEArRi6sq_eGZ-ZVvYLDy8ZenKfZrFhxNnzgRKr_4g.JPEG/47%EC%81%98%EB%9D%A0%ED%94%84%EB%9E%91%EC%8A%A4%28%EC%97%BD%EC%84%9C%29.jpg?type=w1200" />
            </div>
          </div>  -->

          <!-- 네비게이션 버튼 -->
          <!-- <div class="swiper-button-next"></div> 다음 버튼 (오른쪽에 있는 버튼)
           <div class="swiper-button-prev"></div> 이전 버튼 -->
        
          <!-- 페이징 -->
          <!-- <div class="swiper-pagination"></div>
        </div>   -->

        <div class="content" id = "content" name = "content">
          content
        </div>

      </form>

        <input type="button" id="modify" value="수정" onclick="modifyPost()">
        <input type="button" id="delete" value="삭제"  onclick="deletePost()">

        <!-- 좋아요 버튼-->  
        <div class = "like-content">
          <button class = "btn-secondary like-review">
            <i class = "far fa-heart" aria-hidden = "true"></i> 
        <!-- aria-hidden 특정 상황에만 보여진다?? -->
          <span class="material-icons">
             favorite_border
          </span>
          </button>
          </div>

          <div id='result'>0</div>

            
        <!-- 댓글 -->
          <div id = "comments">
            <div class="comment-wrapper">

              <div id = "comment-head" class = "comment-row">
                <span id = "comments-count"></span> Comment(s)
              </div>
    
            </div>
           
            <!-- <form id="comment"> -->
              <div class = "comment-row">
                  <textarea id = "new-comment" name = "new_comment" row=5 placeholder="New Comment"></textarea>
                  <input type="button" id="submit_btn" value="등록" onclick="submitComment()"/>
              </div>              
            <!-- </form>   -->

              <div class = "comment-row0">
                <div class = "comment-date">2021-11-11</div>
                <div class = "comment-memberName"></div>
                <div class = "comment-content">Sample1</div>
                <!-- <input type="button" class="modifycomment" value="수정" onclick="modifyComment()">
                <input type="button" class="deletecomment" value="삭제"  onclick="deleteComment()"> -->
              </div>

              <!-- <div class = "comment-row">
                <div class = "comment-date">2021-11-11</div>
                <div class = "comment-content">Sample2</div>
              </div> -->

          </div>
  </div>
  </div>

    <!-- footer 연결 -->
    <div id="footers"></div>
    
</body>
</html>